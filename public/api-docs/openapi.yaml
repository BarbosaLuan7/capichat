openapi: 3.0.3
info:
  title: LB ADV CRM API
  version: 2.1.0
  description: |
    API RESTful para integração externa com o **LB ADV CRM** (GaranteDireito).

    Sistema especializado em Direito Previdenciário, com gestão de casos e atendimento via WhatsApp.

    ## Autenticação

    Todas as requisições devem incluir um header de autorização:

    ```
    Authorization: Bearer {seu_token}
    ```

    O token pode ser gerado em **Ajustes > Integrações > API**.

    ## Base URL

    Todas as requisições devem ser feitas para:
    ```
    https://vnsypopnzwtkmyvxvqpu.supabase.co/functions/v1
    ```

    ## Rate Limiting

    | Operação | Limite |
    |----------|--------|
    | Envio de mensagens | 300 req/min |
    | Leitura (GET) | 3000 req/min |
    | Escrita (POST/PUT/DELETE) | 500 req/min |
    | Webhooks recebidos | 1000 req/min |

    ## Paginação

    Endpoints de listagem retornam:
    ```json
    {
      "dados": [...],
      "paginacao": {
        "pagina": 1,
        "por_pagina": 50,
        "total": 150,
        "total_paginas": 3
      }
    }
    ```

    ## Estrutura de Respostas

    Todas as respostas seguem o padrão em português brasileiro para facilitar integração.

  contact:
    name: GaranteDireito Suporte
    email: contato@garantedireito.com.br
  license:
    name: Proprietária

servers:
  - url: https://vnsypopnzwtkmyvxvqpu.supabase.co/functions/v1
    description: Produção (Edge Functions)

security:
  - BearerAuth: []

tags:
  # CORE
  - name: Usuários
    description: Gerenciamento de usuários/atendentes do sistema
  - name: Equipes
    description: Gerenciamento de equipes de atendimento
  - name: Contatos
    description: Gerenciamento de contatos/leads
  - name: Etiquetas
    description: Gerenciamento de etiquetas (tags)
  - name: Campos Personalizados
    description: Campos customizados para contatos
  - name: Carteiras
    description: Agrupamento de contatos em carteiras
  - name: Webhooks
    description: Configuração de webhooks para eventos
  - name: Arquivos
    description: Upload e gerenciamento de arquivos

  # CHAT
  - name: Conversas
    description: Gerenciamento de conversas/atendimentos
  - name: Mensagens
    description: Envio e recebimento de mensagens
  - name: Mensagens Agendadas
    description: Agendamento de mensagens
  - name: Templates
    description: Modelos de mensagens rápidas
  - name: Canais
    description: Canais de atendimento (WhatsApp)
  - name: Chatbots
    description: Fluxos de chatbot automatizados

  # CRM
  - name: Oportunidades
    description: Cards/oportunidades no funil
  - name: Funis
    description: Painéis e etapas do funil de vendas
  - name: Tarefas
    description: Tarefas e lembretes

paths:
  # ============================================================================
  # CORE - USUÁRIOS
  # ============================================================================
  /api-users:
    get:
      tags: [Usuários]
      summary: Listar usuários
      description: Retorna lista paginada de usuários do sistema.
      parameters:
        - name: page
          in: query
          description: Número da página
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          description: Itens por página
          schema:
            type: integer
            default: 50
        - name: ativo
          in: query
          description: Filtrar por status ativo
          schema:
            type: boolean
        - name: disponivel
          in: query
          description: Filtrar por disponibilidade para atendimento
          schema:
            type: boolean
      responses:
        "200":
          description: Lista de usuários
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Usuario"
                  paginacao:
                    $ref: "#/components/schemas/Paginacao"
        "401":
          $ref: "#/components/responses/NaoAutorizado"

    post:
      tags: [Usuários]
      summary: Criar usuário
      description: |
        ⚠️ A criação de usuários deve ser feita via interface administrativa.
        Este endpoint retornará erro orientando o uso correto.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                nome:
                  type: string
                email:
                  type: string
      responses:
        "400":
          description: Deve usar interface administrativa

  /api-users?id={id}:
    get:
      tags: [Usuários]
      summary: Buscar usuário
      description: Retorna detalhes de um usuário específico.
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados do usuário
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Usuario"
        "404":
          $ref: "#/components/responses/NaoEncontrado"

    put:
      tags: [Usuários]
      summary: Atualizar usuário
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarUsuarioRequest"
      responses:
        "200":
          description: Usuário atualizado

    delete:
      tags: [Usuários]
      summary: Desativar usuário
      description: Desativa um usuário do sistema.
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Usuário desativado

  /api-users?id={id}&action=equipes:
    post:
      tags: [Usuários]
      summary: Atualizar equipes do usuário
      description: Define quais equipes o usuário pertence.
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [equipes]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                equipes:
                  type: array
                  items:
                    type: object
                    properties:
                      equipe_id:
                        type: string
                      supervisor:
                        type: boolean
      responses:
        "200":
          description: Equipes atualizadas

  /api-users?id={id}&action=status:
    post:
      tags: [Usuários]
      summary: Alterar status do usuário
      description: Ativa ou desativa um usuário.
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [status]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                ativo:
                  type: boolean
      responses:
        "200":
          description: Status alterado

  /api-users?id={id}&action=disponibilidade:
    post:
      tags: [Usuários]
      summary: Alterar disponibilidade
      description: Altera a disponibilidade do usuário para receber novos atendimentos.
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [disponibilidade]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                disponivel:
                  type: boolean
      responses:
        "200":
          description: Disponibilidade alterada

  # ============================================================================
  # CORE - EQUIPES
  # ============================================================================
  /api-teams:
    get:
      tags: [Equipes]
      summary: Listar equipes
      description: Retorna lista de equipes de atendimento.
      responses:
        "200":
          description: Lista de equipes
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Equipe"

    post:
      tags: [Equipes]
      summary: Criar equipe
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarEquipeRequest"
      responses:
        "201":
          description: Equipe criada

  /api-teams?id={id}:
    get:
      tags: [Equipes]
      summary: Buscar equipe
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados da equipe
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/EquipeDetalhada"

    put:
      tags: [Equipes]
      summary: Atualizar equipe
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarEquipeRequest"
      responses:
        "200":
          description: Equipe atualizada

    delete:
      tags: [Equipes]
      summary: Remover equipe
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Equipe removida

  /api-teams?id={id}&action=usuarios:
    put:
      tags: [Equipes]
      summary: Atualizar membros da equipe
      description: Define quais usuários pertencem à equipe.
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [usuarios]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                usuarios:
                  type: array
                  items:
                    type: object
                    properties:
                      usuario_id:
                        type: string
                      supervisor:
                        type: boolean
      responses:
        "200":
          description: Membros atualizados

  /api-teams?id={id}&action=canais:
    get:
      tags: [Equipes]
      summary: Listar canais da equipe
      description: Retorna os canais de atendimento associados à equipe.
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [canais]
      responses:
        "200":
          description: Lista de canais

  # ============================================================================
  # CORE - CONTATOS (LEADS)
  # ============================================================================
  /api-leads:
    get:
      tags: [Contatos]
      summary: Listar contatos
      description: Retorna lista paginada de contatos.
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        "200":
          description: Lista de contatos
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Contato"
                  total:
                    type: integer
                  limit:
                    type: integer
                  offset:
                    type: integer

    post:
      tags: [Contatos]
      summary: Criar contato
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarContatoRequest"
      responses:
        "201":
          description: Contato criado
        "200":
          description: Contato já existia (retorna dados existentes com is_duplicate=true)

  /api-leads?id={id}:
    get:
      tags: [Contatos]
      summary: Buscar contato
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados do contato
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Contato"
        "404":
          $ref: "#/components/responses/NaoEncontrado"

    put:
      tags: [Contatos]
      summary: Atualizar contato
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarContatoRequest"
      responses:
        "200":
          description: Contato atualizado

    delete:
      tags: [Contatos]
      summary: Remover contato
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Contato removido

  /api-leads?phone={telefone}:
    get:
      tags: [Contatos]
      summary: Buscar contato por telefone
      parameters:
        - name: phone
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Contatos encontrados
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Contato"

  /api-contatos-lote:
    post:
      tags: [Contatos]
      summary: Criar contatos em lote
      description: Cria múltiplos contatos de uma vez (máximo 100 por requisição).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - contatos
              properties:
                contatos:
                  type: array
                  maxItems: 100
                  items:
                    $ref: "#/components/schemas/CriarContatoLoteItem"
            example:
              contatos:
                - nome: "Maria Silva"
                  telefone: "11999990001"
                  email: "maria@email.com"
                - nome: "João Santos"
                  telefone: "11999990002"
                  tipo_beneficio: "BPC Idoso"
      responses:
        "200":
          description: Resultado do processamento em lote
          content:
            application/json:
              schema:
                type: object
                properties:
                  sucesso:
                    type: boolean
                  resumo:
                    type: object
                    properties:
                      total:
                        type: integer
                      criados:
                        type: integer
                      duplicados:
                        type: integer
                      erros:
                        type: integer
                  resultados:
                    type: array
                    items:
                      type: object
                      properties:
                        indice:
                          type: integer
                        sucesso:
                          type: boolean
                        id:
                          type: string
                        erro:
                          type: string
                        duplicado:
                          type: boolean

  # ============================================================================
  # CORE - ETIQUETAS
  # ============================================================================
  /api-tags:
    get:
      tags: [Etiquetas]
      summary: Listar etiquetas
      responses:
        "200":
          description: Lista de etiquetas
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Etiqueta"

    post:
      tags: [Etiquetas]
      summary: Criar etiqueta
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarEtiquetaRequest"
      responses:
        "201":
          description: Etiqueta criada

  /api-tags?id={id}:
    get:
      tags: [Etiquetas]
      summary: Buscar etiqueta
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados da etiqueta

    put:
      tags: [Etiquetas]
      summary: Atualizar etiqueta
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarEtiquetaRequest"
      responses:
        "200":
          description: Etiqueta atualizada

    delete:
      tags: [Etiquetas]
      summary: Remover etiqueta
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Etiqueta removida

  # ============================================================================
  # CORE - CAMPOS PERSONALIZADOS
  # ============================================================================
  /api-campos-personalizados:
    get:
      tags: [Campos Personalizados]
      summary: Listar campos personalizados
      parameters:
        - name: tenant_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Lista de campos
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/CampoPersonalizado"

    post:
      tags: [Campos Personalizados]
      summary: Criar campo personalizado
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarCampoRequest"
            example:
              nome: "data_pericia"
              rotulo: "Data da Perícia"
              tipo: "data"
              obrigatorio: false
      responses:
        "201":
          description: Campo criado

  /api-campos-personalizados?id={id}:
    get:
      tags: [Campos Personalizados]
      summary: Buscar campo
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados do campo

    put:
      tags: [Campos Personalizados]
      summary: Atualizar campo
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarCampoRequest"
      responses:
        "200":
          description: Campo atualizado

    delete:
      tags: [Campos Personalizados]
      summary: Remover campo
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Campo removido

  # ============================================================================
  # CORE - CARTEIRAS
  # ============================================================================
  /api-carteiras:
    get:
      tags: [Carteiras]
      summary: Listar carteiras
      parameters:
        - name: tenant_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Lista de carteiras
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Carteira"

    post:
      tags: [Carteiras]
      summary: Criar carteira
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarCarteiraRequest"
            example:
              nome: "Clientes BPC"
              descricao: "Carteira de clientes BPC"
              cor: "#22c55e"
      responses:
        "201":
          description: Carteira criada

  /api-carteiras?id={id}:
    get:
      tags: [Carteiras]
      summary: Buscar carteira
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados da carteira
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Carteira"

    put:
      tags: [Carteiras]
      summary: Atualizar carteira
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarCarteiraRequest"
      responses:
        "200":
          description: Carteira atualizada

    delete:
      tags: [Carteiras]
      summary: Remover carteira
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Carteira removida

  /api-carteiras?id={id}&action=contatos:
    get:
      tags: [Carteiras]
      summary: Listar contatos da carteira
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [contatos]
        - name: pagina
          in: query
          schema:
            type: integer
            default: 1
        - name: por_pagina
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Lista de contatos

    post:
      tags: [Carteiras]
      summary: Adicionar contato à carteira
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [contatos]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - contato_id
              properties:
                contato_id:
                  type: string
                  format: uuid
      responses:
        "201":
          description: Contato adicionado

  /api-carteiras?id={id}&action=contatos&contato_id={contato_id}:
    delete:
      tags: [Carteiras]
      summary: Remover contato da carteira
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [contatos]
        - name: contato_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Contato removido

  # ============================================================================
  # CORE - WEBHOOKS
  # ============================================================================
  /api-webhooks:
    get:
      tags: [Webhooks]
      summary: Listar webhooks
      responses:
        "200":
          description: Lista de webhooks
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Webhook"

    post:
      tags: [Webhooks]
      summary: Criar webhook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarWebhookRequest"
      responses:
        "201":
          description: Webhook criado

  /api-webhooks?id={id}:
    get:
      tags: [Webhooks]
      summary: Buscar webhook
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados do webhook

    put:
      tags: [Webhooks]
      summary: Atualizar webhook
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarWebhookRequest"
      responses:
        "200":
          description: Webhook atualizado

    delete:
      tags: [Webhooks]
      summary: Remover webhook
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Webhook removido

  /api-webhooks?action=eventos:
    get:
      tags: [Webhooks]
      summary: Listar eventos disponíveis
      description: Retorna lista de eventos que podem disparar webhooks.
      parameters:
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [eventos]
      responses:
        "200":
          description: Lista de eventos
          content:
            application/json:
              schema:
                type: object
                properties:
                  eventos:
                    type: array
                    items:
                      type: object
                      properties:
                        evento:
                          type: string
                        descricao:
                          type: string

  # ============================================================================
  # CORE - ARQUIVOS
  # ============================================================================
  /api-arquivos:
    get:
      tags: [Arquivos]
      summary: Obter URL de upload
      description: Gera uma URL assinada para upload de arquivo.
      parameters:
        - name: nome_arquivo
          in: query
          required: true
          schema:
            type: string
        - name: tipo_mime
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: URL de upload gerada
          content:
            application/json:
              schema:
                type: object
                properties:
                  sucesso:
                    type: boolean
                  upload:
                    type: object
                    properties:
                      url:
                        type: string
                      token:
                        type: string
                      path:
                        type: string
                      expira_em:
                        type: string
                        format: date-time

    post:
      tags: [Arquivos]
      summary: Confirmar upload
      description: Confirma que o upload foi concluído e obtém URL permanente.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - path
              properties:
                path:
                  type: string
                nome_original:
                  type: string
      responses:
        "200":
          description: Upload confirmado
          content:
            application/json:
              schema:
                type: object
                properties:
                  sucesso:
                    type: boolean
                  arquivo:
                    type: object
                    properties:
                      path:
                        type: string
                      url:
                        type: string
                      nome:
                        type: string

  /api-arquivos?path={path}:
    delete:
      tags: [Arquivos]
      summary: Remover arquivo
      parameters:
        - name: path
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Arquivo removido

  # ============================================================================
  # CHAT - CONVERSAS
  # ============================================================================
  /api-conversations:
    get:
      tags: [Conversas]
      summary: Listar conversas
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [open, pending, resolved]
        - name: assigned_to
          in: query
          schema:
            type: string
            format: uuid
        - name: lead_id
          in: query
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Lista de conversas
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Conversa"
                  pagination:
                    $ref: "#/components/schemas/Paginacao"

    post:
      tags: [Conversas]
      summary: Criar conversa
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - lead_id
              properties:
                lead_id:
                  type: string
                  format: uuid
                assigned_to:
                  type: string
                  format: uuid
                status:
                  type: string
                  enum: [open, pending, resolved]
      responses:
        "201":
          description: Conversa criada

  /api-conversations?id={id}:
    get:
      tags: [Conversas]
      summary: Buscar conversa com mensagens
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Conversa com mensagens
          content:
            application/json:
              schema:
                allOf:
                  - $ref: "#/components/schemas/Conversa"
                  - type: object
                    properties:
                      messages:
                        type: array
                        items:
                          $ref: "#/components/schemas/Mensagem"

    put:
      tags: [Conversas]
      summary: Atualizar conversa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                assigned_to:
                  type: string
                is_favorite:
                  type: boolean
      responses:
        "200":
          description: Conversa atualizada

    delete:
      tags: [Conversas]
      summary: Remover conversa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Conversa removida

  /api-conversations?id={id}&action=transferir:
    put:
      tags: [Conversas]
      summary: Transferir conversa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [transferir]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                tipo:
                  type: string
                  enum: [usuario, equipe]
                usuario_id:
                  type: string
                  format: uuid
                equipe_id:
                  type: string
                  format: uuid
      responses:
        "200":
          description: Conversa transferida

  /api-conversations?id={id}&action=atribuir:
    put:
      tags: [Conversas]
      summary: Atribuir conversa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [atribuir]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - usuario_id
              properties:
                usuario_id:
                  type: string
                  format: uuid
      responses:
        "200":
          description: Conversa atribuída

  /api-conversations?id={id}&action=finalizar:
    put:
      tags: [Conversas]
      summary: Finalizar conversa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [finalizar]
      responses:
        "200":
          description: Conversa finalizada

  /api-conversations?id={id}&action=reabrir:
    put:
      tags: [Conversas]
      summary: Reabrir conversa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [reabrir]
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                responsavel_id:
                  type: string
                  format: uuid
      responses:
        "200":
          description: Conversa reaberta

  /api-conversations?id={id}&action=notas:
    get:
      tags: [Conversas]
      summary: Listar notas internas
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [notas]
      responses:
        "200":
          description: Lista de notas
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NotaInterna"

    post:
      tags: [Conversas]
      summary: Adicionar nota interna
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [notas]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - conteudo
              properties:
                conteudo:
                  type: string
                author_id:
                  type: string
                  format: uuid
      responses:
        "201":
          description: Nota adicionada

  # ============================================================================
  # CHAT - MENSAGENS
  # ============================================================================
  /chat-v2-mensagem:
    post:
      tags: [Mensagens]
      summary: Enviar mensagem
      description: Envia uma mensagem para um contato via WhatsApp.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EnviarMensagemRequest"
            example:
              contato_id: "550e8400-e29b-41d4-a716-446655440000"
              tipo: "texto"
              conteudo: "Olá! Como posso ajudá-lo hoje?"
      responses:
        "200":
          description: Mensagem enviada
          content:
            application/json:
              schema:
                type: object
                properties:
                  sucesso:
                    type: boolean
                  mensagem:
                    $ref: "#/components/schemas/Mensagem"

  /api-mensagens?id={id}:
    get:
      tags: [Mensagens]
      summary: Buscar mensagem
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados da mensagem
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/MensagemDetalhada"

    delete:
      tags: [Mensagens]
      summary: Apagar mensagem
      description: Marca a mensagem como apagada localmente.
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Mensagem apagada

  /api-mensagens?id={id}&action=status:
    get:
      tags: [Mensagens]
      summary: Status de entrega
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [status]
      responses:
        "200":
          description: Status da mensagem
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  status:
                    type: string
                    enum: [enviada, entregue, lida]
                  atualizado_em:
                    type: string
                    format: date-time

  /api-mensagens?conversa_id={conversa_id}:
    get:
      tags: [Mensagens]
      summary: Listar mensagens da conversa
      parameters:
        - name: conversa_id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: pagina
          in: query
          schema:
            type: integer
            default: 1
        - name: por_pagina
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Lista de mensagens
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/MensagemDetalhada"
                  paginacao:
                    $ref: "#/components/schemas/Paginacao"

  # ============================================================================
  # CHAT - MENSAGENS AGENDADAS
  # ============================================================================
  /api-mensagens-agendadas:
    get:
      tags: [Mensagens Agendadas]
      summary: Listar mensagens agendadas
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, sent, cancelled, failed]
        - name: pagina
          in: query
          schema:
            type: integer
            default: 1
        - name: por_pagina
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Lista de agendamentos
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/MensagemAgendada"
                  paginacao:
                    $ref: "#/components/schemas/Paginacao"

    post:
      tags: [Mensagens Agendadas]
      summary: Agendar mensagem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AgendarMensagemRequest"
            example:
              contato_id: "550e8400-e29b-41d4-a716-446655440000"
              conteudo: "Lembrete: sua perícia é amanhã às 10h."
              agendar_para: "2025-01-10T09:00:00-03:00"
      responses:
        "201":
          description: Mensagem agendada

  /api-mensagens-agendadas?id={id}:
    get:
      tags: [Mensagens Agendadas]
      summary: Buscar agendamento
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados do agendamento

    put:
      tags: [Mensagens Agendadas]
      summary: Atualizar agendamento
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                conteudo:
                  type: string
                agendar_para:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Agendamento atualizado

    delete:
      tags: [Mensagens Agendadas]
      summary: Remover agendamento
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Agendamento removido

  /api-mensagens-agendadas?id={id}&action=cancelar:
    post:
      tags: [Mensagens Agendadas]
      summary: Cancelar agendamento
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [cancelar]
      responses:
        "200":
          description: Agendamento cancelado

  # ============================================================================
  # CHAT - TEMPLATES
  # ============================================================================
  /api-templates:
    get:
      tags: [Templates]
      summary: Listar templates
      responses:
        "200":
          description: Lista de templates
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Template"

    post:
      tags: [Templates]
      summary: Criar template
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarTemplateRequest"
      responses:
        "201":
          description: Template criado

  /api-templates?id={id}:
    get:
      tags: [Templates]
      summary: Buscar template
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados do template

    put:
      tags: [Templates]
      summary: Atualizar template
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarTemplateRequest"
      responses:
        "200":
          description: Template atualizado

    delete:
      tags: [Templates]
      summary: Remover template
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Template removido

  # ============================================================================
  # CHAT - CANAIS
  # ============================================================================
  /api-whatsapp-instances:
    get:
      tags: [Canais]
      summary: Listar canais WhatsApp
      responses:
        "200":
          description: Lista de canais
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Canal"

  /api-whatsapp-instances?id={id}:
    get:
      tags: [Canais]
      summary: Buscar canal
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados do canal

  # ============================================================================
  # CHAT - CHATBOTS
  # ============================================================================
  /api-chatbots:
    get:
      tags: [Chatbots]
      summary: Listar chatbots
      responses:
        "200":
          description: Lista de chatbots
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Chatbot"

    post:
      tags: [Chatbots]
      summary: Criar chatbot
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarChatbotRequest"
      responses:
        "201":
          description: Chatbot criado

  /api-chatbots?id={id}:
    get:
      tags: [Chatbots]
      summary: Buscar chatbot
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados do chatbot

    put:
      tags: [Chatbots]
      summary: Atualizar chatbot
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarChatbotRequest"
      responses:
        "200":
          description: Chatbot atualizado

    delete:
      tags: [Chatbots]
      summary: Remover chatbot
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Chatbot removido

  /api-chatbots?action=enviar:
    post:
      tags: [Chatbots]
      summary: Iniciar fluxo de chatbot
      description: Inicia um fluxo de chatbot para um contato específico.
      parameters:
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [enviar]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - chatbot_id
                - contato_id
              properties:
                chatbot_id:
                  type: string
                  format: uuid
                contato_id:
                  type: string
                  format: uuid
      responses:
        "200":
          description: Fluxo iniciado

  # ============================================================================
  # CRM - OPORTUNIDADES
  # ============================================================================
  /api-oportunidades:
    get:
      tags: [Oportunidades]
      summary: Listar oportunidades
      parameters:
        - name: etapa_id
          in: query
          schema:
            type: string
            format: uuid
        - name: responsavel_id
          in: query
          schema:
            type: string
            format: uuid
        - name: pagina
          in: query
          schema:
            type: integer
            default: 1
        - name: por_pagina
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Lista de oportunidades
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Oportunidade"
                  paginacao:
                    $ref: "#/components/schemas/Paginacao"

    post:
      tags: [Oportunidades]
      summary: Criar oportunidade
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarOportunidadeRequest"
      responses:
        "201":
          description: Oportunidade criada

  /api-oportunidades?id={id}:
    get:
      tags: [Oportunidades]
      summary: Buscar oportunidade
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados da oportunidade
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Oportunidade"

    put:
      tags: [Oportunidades]
      summary: Atualizar oportunidade
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarOportunidadeRequest"
      responses:
        "200":
          description: Oportunidade atualizada

    delete:
      tags: [Oportunidades]
      summary: Arquivar oportunidade
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Oportunidade arquivada

  /api-oportunidades?id={id}&action=duplicar:
    post:
      tags: [Oportunidades]
      summary: Duplicar oportunidade
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [duplicar]
      responses:
        "201":
          description: Oportunidade duplicada

  /api-oportunidades?id={id}&action=mover:
    put:
      tags: [Oportunidades]
      summary: Mover oportunidade de etapa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [mover]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - etapa_id
              properties:
                etapa_id:
                  type: string
                  format: uuid
      responses:
        "200":
          description: Oportunidade movida

  /api-oportunidades?id={id}&action=notas:
    get:
      tags: [Oportunidades]
      summary: Listar notas da oportunidade
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [notas]
      responses:
        "200":
          description: Lista de notas

    post:
      tags: [Oportunidades]
      summary: Adicionar nota à oportunidade
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [notas]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - conteudo
              properties:
                conteudo:
                  type: string
      responses:
        "201":
          description: Nota adicionada

  # ============================================================================
  # CRM - FUNIS
  # ============================================================================
  /api-funnels:
    get:
      tags: [Funis]
      summary: Listar funis
      parameters:
        - name: tenant_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Lista de funis
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Funil"

  /api-funnels?id={id}:
    get:
      tags: [Funis]
      summary: Buscar funil
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Dados do funil
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/FunilDetalhado"

  # ============================================================================
  # CRM - TAREFAS
  # ============================================================================
  /api-tasks:
    get:
      tags: [Tarefas]
      summary: Listar tarefas
      parameters:
        - name: status
          in: query
          schema:
            type: string
            enum: [todo, in_progress, done]
        - name: assigned_to
          in: query
          schema:
            type: string
            format: uuid
        - name: lead_id
          in: query
          schema:
            type: string
            format: uuid
        - name: pagina
          in: query
          schema:
            type: integer
            default: 1
        - name: por_pagina
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Lista de tarefas
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Tarefa"
                  paginacao:
                    $ref: "#/components/schemas/Paginacao"

    post:
      tags: [Tarefas]
      summary: Criar tarefa
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarTarefaRequest"
      responses:
        "201":
          description: Tarefa criada

  /api-tasks?id={id}:
    get:
      tags: [Tarefas]
      summary: Buscar tarefa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Dados da tarefa

    put:
      tags: [Tarefas]
      summary: Atualizar tarefa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarTarefaRequest"
      responses:
        "200":
          description: Tarefa atualizada

    delete:
      tags: [Tarefas]
      summary: Remover tarefa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Tarefa removida

  /api-tasks?id={id}&action=concluir:
    post:
      tags: [Tarefas]
      summary: Concluir tarefa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [concluir]
      responses:
        "200":
          description: Tarefa concluída

# ============================================================================
# COMPONENTS
# ============================================================================
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: API Key
      description: |
        Use sua API key gerada em Ajustes > Integrações > API.

        Exemplo: `Authorization: Bearer gd_live_abc123...`

  schemas:
    # ------------ Paginação ------------
    Paginacao:
      type: object
      properties:
        pagina:
          type: integer
        por_pagina:
          type: integer
        total:
          type: integer
        total_paginas:
          type: integer

    # ------------ Usuários ------------
    Usuario:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        email:
          type: string
        telefone:
          type: string
        avatar_url:
          type: string
        perfil:
          type: string
          enum: [administrador, gerente, atendente, visualizador]
        ativo:
          type: boolean
        disponivel:
          type: boolean
        dono_conta:
          type: boolean
        equipes:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              nome:
                type: string
              supervisor:
                type: boolean
        criado_em:
          type: string
          format: date-time

    AtualizarUsuarioRequest:
      type: object
      properties:
        nome:
          type: string
        telefone:
          type: string
        disponivel:
          type: boolean

    # ------------ Equipes ------------
    Equipe:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        nivel_acesso:
          type: string
          enum: [todos, equipe, atendente]
        distribuicao_automatica:
          type: boolean
        equipe_padrao:
          type: boolean
        total_membros:
          type: integer
        membros_disponiveis:
          type: integer
        criado_em:
          type: string
          format: date-time

    EquipeDetalhada:
      allOf:
        - $ref: "#/components/schemas/Equipe"
        - type: object
          properties:
            membros:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                  nome:
                    type: string
                  supervisor:
                    type: boolean
                  disponivel:
                    type: boolean
            canais:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: string
                  nome:
                    type: string
                  telefone:
                    type: string

    CriarEquipeRequest:
      type: object
      required:
        - nome
      properties:
        nome:
          type: string
        nivel_acesso:
          type: string
          enum: [todos, equipe, atendente]
        distribuicao_automatica:
          type: boolean

    AtualizarEquipeRequest:
      type: object
      properties:
        nome:
          type: string
        nivel_acesso:
          type: string
        distribuicao_automatica:
          type: boolean

    # ------------ Contatos ------------
    Contato:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        telefone:
          type: string
        codigo_pais:
          type: string
        email:
          type: string
        cpf:
          type: string
        avatar_url:
          type: string
        etapa_id:
          type: string
        temperatura:
          type: string
          enum: [frio, morno, quente]
        responsavel_id:
          type: string
        tipo_beneficio:
          type: string
        etiquetas:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              nome:
                type: string
              cor:
                type: string
        criado_em:
          type: string
          format: date-time

    CriarContatoRequest:
      type: object
      required:
        - name
        - phone
      properties:
        name:
          type: string
        phone:
          type: string
        country_code:
          type: string
        email:
          type: string
        cpf:
          type: string
        birth_date:
          type: string
          format: date
        benefit_type:
          type: string
        nit_pis:
          type: string
        utm_source:
          type: string
        utm_medium:
          type: string
        source:
          type: string
        stage_id:
          type: string
          format: uuid
        assigned_to:
          type: string
          format: uuid
        temperature:
          type: string
          enum: [cold, warm, hot]
        custom_fields:
          type: object
        tenant_id:
          type: string
          format: uuid

    CriarContatoLoteItem:
      type: object
      required:
        - nome
        - telefone
      properties:
        nome:
          type: string
        telefone:
          type: string
        codigo_pais:
          type: string
        email:
          type: string
        cpf:
          type: string
        data_nascimento:
          type: string
          format: date
        tipo_beneficio:
          type: string
        nit_pis:
          type: string
        origem:
          type: string
        etapa_id:
          type: string
          format: uuid
        responsavel_id:
          type: string
          format: uuid
        temperatura:
          type: string
          enum: [frio, morno, quente]
        campos_personalizados:
          type: object
        etiquetas:
          type: array
          items:
            type: string
            format: uuid

    AtualizarContatoRequest:
      type: object
      properties:
        name:
          type: string
        phone:
          type: string
        email:
          type: string
        stage_id:
          type: string
          format: uuid
        temperature:
          type: string
          enum: [cold, warm, hot]
        assigned_to:
          type: string
          format: uuid

    # ------------ Etiquetas ------------
    Etiqueta:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        cor:
          type: string
        categoria:
          type: string
          enum: [origem, interesse, prioridade, status, beneficio, condicao_saude, desqualificacao, situacao, perda]

    CriarEtiquetaRequest:
      type: object
      required:
        - nome
      properties:
        nome:
          type: string
        cor:
          type: string
        categoria:
          type: string

    AtualizarEtiquetaRequest:
      type: object
      properties:
        nome:
          type: string
        cor:
          type: string

    # ------------ Campos Personalizados ------------
    CampoPersonalizado:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        rotulo:
          type: string
        tipo:
          type: string
          enum: [texto, numero, data, selecao, selecao_multipla, booleano]
        opcoes:
          type: array
          items:
            type: string
        obrigatorio:
          type: boolean
        ordem:
          type: integer
        ativo:
          type: boolean

    CriarCampoRequest:
      type: object
      required:
        - nome
        - rotulo
      properties:
        nome:
          type: string
        rotulo:
          type: string
        tipo:
          type: string
          enum: [texto, numero, data, selecao, selecao_multipla, booleano]
        opcoes:
          type: array
          items:
            type: string
        obrigatorio:
          type: boolean
        ordem:
          type: integer

    AtualizarCampoRequest:
      type: object
      properties:
        nome:
          type: string
        rotulo:
          type: string
        tipo:
          type: string
        opcoes:
          type: array
          items:
            type: string
        obrigatorio:
          type: boolean
        ordem:
          type: integer

    # ------------ Carteiras ------------
    Carteira:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        descricao:
          type: string
        cor:
          type: string
        total_contatos:
          type: integer
        criada_em:
          type: string
          format: date-time

    CriarCarteiraRequest:
      type: object
      required:
        - nome
      properties:
        nome:
          type: string
        descricao:
          type: string
        cor:
          type: string

    AtualizarCarteiraRequest:
      type: object
      properties:
        nome:
          type: string
        descricao:
          type: string
        cor:
          type: string

    # ------------ Webhooks ------------
    Webhook:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        url:
          type: string
        eventos:
          type: array
          items:
            type: string
        ativo:
          type: boolean
        criado_em:
          type: string
          format: date-time

    CriarWebhookRequest:
      type: object
      required:
        - nome
        - url
        - eventos
      properties:
        nome:
          type: string
        url:
          type: string
        eventos:
          type: array
          items:
            type: string
        headers:
          type: object

    AtualizarWebhookRequest:
      type: object
      properties:
        nome:
          type: string
        url:
          type: string
        eventos:
          type: array
          items:
            type: string
        ativo:
          type: boolean

    # ------------ Conversas ------------
    Conversa:
      type: object
      properties:
        id:
          type: string
        lead_id:
          type: string
        lead:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
            phone:
              type: string
            avatar_url:
              type: string
        assigned_to:
          type: string
        status:
          type: string
          enum: [open, pending, resolved]
        unread_count:
          type: integer
        last_message_at:
          type: string
          format: date-time
        last_message_content:
          type: string
        is_favorite:
          type: boolean
        created_at:
          type: string
          format: date-time

    NotaInterna:
      type: object
      properties:
        id:
          type: string
        conteudo:
          type: string
        autor:
          type: object
          properties:
            id:
              type: string
            nome:
              type: string
        criada_em:
          type: string
          format: date-time

    # ------------ Mensagens ------------
    Mensagem:
      type: object
      properties:
        id:
          type: string
        conversation_id:
          type: string
        type:
          type: string
          enum: [text, image, audio, video, document]
        content:
          type: string
        sender_type:
          type: string
          enum: [lead, agent]
        sender_id:
          type: string
        direction:
          type: string
          enum: [inbound, outbound]
        status:
          type: string
          enum: [sent, delivered, read]
        media_url:
          type: string
        created_at:
          type: string
          format: date-time

    MensagemDetalhada:
      type: object
      properties:
        id:
          type: string
        conversa_id:
          type: string
        tipo:
          type: string
          enum: [texto, imagem, audio, video, documento]
        conteudo:
          type: string
        remetente_tipo:
          type: string
          enum: [contato, atendente]
        remetente_id:
          type: string
        direcao:
          type: string
          enum: [entrada, saida]
        status:
          type: string
          enum: [enviada, entregue, lida]
        media_url:
          type: string
        transcricao:
          type: string
        externa_id:
          type: string
        enviada_em:
          type: string
          format: date-time

    EnviarMensagemRequest:
      type: object
      required:
        - contato_id
        - conteudo
      properties:
        contato_id:
          type: string
          format: uuid
        tipo:
          type: string
          enum: [texto, imagem, audio, video, documento]
          default: texto
        conteudo:
          type: string
        media_url:
          type: string
        template_id:
          type: string
          format: uuid

    # ------------ Mensagens Agendadas ------------
    MensagemAgendada:
      type: object
      properties:
        id:
          type: string
        contato_id:
          type: string
        conversa_id:
          type: string
        conteudo:
          type: string
        agendado_para:
          type: string
          format: date-time
        status:
          type: string
          enum: [pending, sent, cancelled, failed]
        enviado_em:
          type: string
          format: date-time
        erro:
          type: string
        criado_em:
          type: string
          format: date-time

    AgendarMensagemRequest:
      type: object
      required:
        - contato_id
        - conteudo
        - agendar_para
      properties:
        contato_id:
          type: string
          format: uuid
        conversa_id:
          type: string
          format: uuid
        conteudo:
          type: string
        agendar_para:
          type: string
          format: date-time
        template_id:
          type: string
          format: uuid

    # ------------ Templates ------------
    Template:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        atalho:
          type: string
        conteudo:
          type: string
        criado_em:
          type: string
          format: date-time

    CriarTemplateRequest:
      type: object
      required:
        - nome
        - atalho
        - conteudo
      properties:
        nome:
          type: string
        atalho:
          type: string
        conteudo:
          type: string

    AtualizarTemplateRequest:
      type: object
      properties:
        nome:
          type: string
        atalho:
          type: string
        conteudo:
          type: string

    # ------------ Canais ------------
    Canal:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        tipo:
          type: string
          enum: [whatsapp]
        telefone:
          type: string
        ativo:
          type: boolean
        criado_em:
          type: string
          format: date-time

    # ------------ Chatbots ------------
    Chatbot:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        descricao:
          type: string
        ativo:
          type: boolean
        nodes:
          type: array
          items:
            type: object
        connections:
          type: array
          items:
            type: object
        criado_em:
          type: string
          format: date-time

    CriarChatbotRequest:
      type: object
      required:
        - nome
      properties:
        nome:
          type: string
        descricao:
          type: string
        nodes:
          type: array
          items:
            type: object
        connections:
          type: array
          items:
            type: object
        ativo:
          type: boolean

    AtualizarChatbotRequest:
      type: object
      properties:
        nome:
          type: string
        descricao:
          type: string
        nodes:
          type: array
          items:
            type: object
        connections:
          type: array
          items:
            type: object
        ativo:
          type: boolean

    # ------------ Oportunidades ------------
    Oportunidade:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        telefone:
          type: string
        email:
          type: string
        etapa_id:
          type: string
        etapa:
          type: object
          properties:
            id:
              type: string
            nome:
              type: string
            cor:
              type: string
        temperatura:
          type: string
          enum: [frio, morno, quente]
        responsavel_id:
          type: string
        valor_estimado:
          type: number
        tipo_beneficio:
          type: string
        status_caso:
          type: string
        etiquetas:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              nome:
                type: string
              cor:
                type: string
        criado_em:
          type: string
          format: date-time
        atualizado_em:
          type: string
          format: date-time

    CriarOportunidadeRequest:
      type: object
      required:
        - nome
        - telefone
      properties:
        nome:
          type: string
        telefone:
          type: string
        email:
          type: string
        etapa_id:
          type: string
          format: uuid
        responsavel_id:
          type: string
          format: uuid
        temperatura:
          type: string
          enum: [frio, morno, quente]
        valor_estimado:
          type: number
        tipo_beneficio:
          type: string
        origem:
          type: string

    AtualizarOportunidadeRequest:
      type: object
      properties:
        nome:
          type: string
        telefone:
          type: string
        email:
          type: string
        etapa_id:
          type: string
          format: uuid
        responsavel_id:
          type: string
          format: uuid
        temperatura:
          type: string
          enum: [frio, morno, quente]
        valor_estimado:
          type: number
        tipo_beneficio:
          type: string
        status_caso:
          type: string

    # ------------ Funis ------------
    Funil:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        total_etapas:
          type: integer
        total_oportunidades:
          type: integer
        etapas:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              nome:
                type: string
              ordem:
                type: integer
              cor:
                type: string
              total:
                type: integer

    FunilDetalhado:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        etapas:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              nome:
                type: string
              ordem:
                type: integer
              cor:
                type: string
              total:
                type: integer

    # ------------ Tarefas ------------
    Tarefa:
      type: object
      properties:
        id:
          type: string
        titulo:
          type: string
        descricao:
          type: string
        status:
          type: string
          enum: [pendente, em_andamento, concluida]
        prioridade:
          type: string
          enum: [urgente, alta, media, baixa]
        responsavel_id:
          type: string
        contato_id:
          type: string
        data_vencimento:
          type: string
          format: date-time
        subtarefas:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              titulo:
                type: string
              concluida:
                type: boolean
        criada_em:
          type: string
          format: date-time

    CriarTarefaRequest:
      type: object
      required:
        - titulo
        - responsavel_id
      properties:
        titulo:
          type: string
        descricao:
          type: string
        prioridade:
          type: string
          enum: [urgente, alta, media, baixa]
        responsavel_id:
          type: string
          format: uuid
        contato_id:
          type: string
          format: uuid
        data_vencimento:
          type: string
          format: date-time

    AtualizarTarefaRequest:
      type: object
      properties:
        titulo:
          type: string
        descricao:
          type: string
        status:
          type: string
          enum: [pendente, em_andamento, concluida]
        prioridade:
          type: string
        data_vencimento:
          type: string
          format: date-time

  responses:
    NaoAutorizado:
      description: Token de autenticação inválido ou ausente
      content:
        application/json:
          schema:
            type: object
            properties:
              sucesso:
                type: boolean
                example: false
              erro:
                type: string
                example: "API key inválida"

    RequisicaoInvalida:
      description: Dados da requisição inválidos
      content:
        application/json:
          schema:
            type: object
            properties:
              sucesso:
                type: boolean
                example: false
              erro:
                type: string

    NaoEncontrado:
      description: Recurso não encontrado
      content:
        application/json:
          schema:
            type: object
            properties:
              sucesso:
                type: boolean
                example: false
              erro:
                type: string
                example: "Recurso não encontrado"
