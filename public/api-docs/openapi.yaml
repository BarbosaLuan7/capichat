openapi: 3.0.3
info:
  title: LB ADV CRM API
  version: 2.2.0
  description: |
    API RESTful para integração externa com o **LB ADV CRM** (GaranteDireito).

    Sistema especializado em Direito Previdenciário, com gestão de casos e atendimento via WhatsApp.

    ## Autenticação

    Todas as requisições devem incluir um header de autorização:

    ```
    Authorization: Bearer {seu_token}
    ```

    O token pode ser gerado em **Ajustes > Integrações > API**.

    ## Base URL

    Todas as requisições devem ser feitas para:
    ```
    https://vnsypopnzwtkmyvxvqpu.supabase.co/functions/v1
    ```

    ## Rate Limiting

    | Operação | Limite |
    |----------|--------|
    | Envio de mensagens | 300 req/min |
    | Leitura (GET) | 3000 req/min |
    | Escrita (POST/PUT/DELETE) | 500 req/min |

    ## Paginação

    Endpoints de listagem retornam:
    ```json
    {
      "dados": [...],
      "paginacao": {
        "pagina": 1,
        "por_pagina": 50,
        "total": 150,
        "total_paginas": 3
      }
    }
    ```

  contact:
    name: GaranteDireito Suporte
    email: contato@garantedireito.com.br
  license:
    name: Proprietária

servers:
  - url: https://vnsypopnzwtkmyvxvqpu.supabase.co/functions/v1
    description: Produção (Edge Functions)

security:
  - BearerAuth: []

tags:
  - name: Usuários
    description: Gerenciamento de usuários/atendentes
  - name: Equipes
    description: Gerenciamento de equipes
  - name: Contatos
    description: Gerenciamento de contatos/leads
  - name: Etiquetas
    description: Gerenciamento de etiquetas
  - name: Campos Personalizados
    description: Campos customizados
  - name: Carteiras
    description: Agrupamento de contatos
  - name: Webhooks
    description: Configuração de webhooks
  - name: Arquivos
    description: Upload de arquivos
  - name: Conversas
    description: Gerenciamento de conversas
  - name: Mensagens
    description: Envio e recebimento de mensagens
  - name: Mensagens Agendadas
    description: Agendamento de mensagens
  - name: Templates
    description: Modelos de mensagens
  - name: Canais
    description: Canais de atendimento (WhatsApp)
  - name: Chatbots
    description: Fluxos de chatbot
  - name: Oportunidades
    description: Cards/oportunidades no funil
  - name: Funis
    description: Painéis e etapas do funil
  - name: Tarefas
    description: Tarefas e lembretes

paths:
  # ============================================================================
  # USUÁRIOS
  # ============================================================================
  /api-users:
    get:
      tags: [Usuários]
      summary: Listar usuários
      operationId: listarUsuarios
      parameters:
        - name: id
          in: query
          description: ID do usuário (para buscar específico)
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 50
        - name: ativo
          in: query
          schema:
            type: boolean
        - name: disponivel
          in: query
          schema:
            type: boolean
        - name: action
          in: query
          description: "Ações: equipes (GET)"
          schema:
            type: string
            enum: [equipes]
      responses:
        "200":
          description: Lista de usuários ou usuário específico
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Usuario"
                  paginacao:
                    $ref: "#/components/schemas/Paginacao"

    post:
      tags: [Usuários]
      summary: Ações em usuário
      operationId: acoesUsuario
      description: |
        Usa o parâmetro `action` para diferentes operações:
        - `equipes`: Atualizar equipes do usuário
        - `status`: Alterar status (ativo/inativo)
        - `disponibilidade`: Alterar disponibilidade
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          required: true
          schema:
            type: string
            enum: [equipes, status, disponibilidade]
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  properties:
                    equipes:
                      type: array
                      items:
                        type: object
                        properties:
                          equipe_id:
                            type: string
                          supervisor:
                            type: boolean
                - type: object
                  properties:
                    ativo:
                      type: boolean
                - type: object
                  properties:
                    disponivel:
                      type: boolean
      responses:
        "200":
          description: Ação executada

    put:
      tags: [Usuários]
      summary: Atualizar usuário
      operationId: atualizarUsuario
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarUsuarioRequest"
      responses:
        "200":
          description: Usuário atualizado

    delete:
      tags: [Usuários]
      summary: Desativar usuário
      operationId: desativarUsuario
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Usuário desativado

  # ============================================================================
  # EQUIPES
  # ============================================================================
  /api-teams:
    get:
      tags: [Equipes]
      summary: Listar equipes
      operationId: listarEquipes
      parameters:
        - name: id
          in: query
          description: ID da equipe (para buscar específica)
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          description: "Ações: canais (GET lista canais da equipe)"
          schema:
            type: string
            enum: [canais]
      responses:
        "200":
          description: Lista de equipes
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Equipe"

    post:
      tags: [Equipes]
      summary: Criar equipe
      operationId: criarEquipe
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarEquipeRequest"
      responses:
        "201":
          description: Equipe criada

    put:
      tags: [Equipes]
      summary: Atualizar equipe
      operationId: atualizarEquipe
      description: |
        Usa o parâmetro `action` para operações específicas:
        - Sem action: Atualiza dados da equipe
        - `usuarios`: Atualiza membros da equipe
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          schema:
            type: string
            enum: [usuarios]
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
                - $ref: "#/components/schemas/AtualizarEquipeRequest"
                - type: object
                  properties:
                    usuarios:
                      type: array
                      items:
                        type: object
                        properties:
                          usuario_id:
                            type: string
                          supervisor:
                            type: boolean
      responses:
        "200":
          description: Equipe atualizada

    delete:
      tags: [Equipes]
      summary: Remover equipe
      operationId: removerEquipe
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Equipe removida

  # ============================================================================
  # CONTATOS (LEADS)
  # ============================================================================
  /api-leads:
    get:
      tags: [Contatos]
      summary: Listar/buscar contatos
      operationId: listarContatos
      parameters:
        - name: id
          in: query
          description: ID do contato (busca específico)
          schema:
            type: string
            format: uuid
        - name: phone
          in: query
          description: Buscar por telefone
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            default: 50
        - name: offset
          in: query
          schema:
            type: integer
            default: 0
      responses:
        "200":
          description: Lista de contatos
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: array
                    items:
                      $ref: "#/components/schemas/Contato"
                  total:
                    type: integer

    post:
      tags: [Contatos]
      summary: Criar contato ou ações
      operationId: criarContato
      description: |
        Sem action: Cria novo contato
        
        Com action:
        - `lote`: Criar múltiplos contatos
        - `filtro`: Busca avançada com filtros
        - `etiquetas` (com id): Gerenciar etiquetas do contato
      parameters:
        - name: id
          in: query
          description: ID do contato (para action=etiquetas)
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          schema:
            type: string
            enum: [lote, filtro, etiquetas]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: "#/components/schemas/CriarContatoRequest"
                - $ref: "#/components/schemas/CriarContatosLoteRequest"
                - $ref: "#/components/schemas/FiltroAvancadoRequest"
                - $ref: "#/components/schemas/GerenciarEtiquetasRequest"
            examples:
              criar_contato:
                summary: Criar contato
                value:
                  name: "Maria Silva"
                  phone: "11999990001"
                  email: "maria@email.com"
                  temperature: "warm"
              criar_lote:
                summary: Criar em lote (action=lote)
                value:
                  contatos:
                    - name: "João Santos"
                      phone: "11999990002"
                    - name: "Ana Costa"
                      phone: "11999990003"
              filtro_avancado:
                summary: Filtro avançado (action=filtro)
                value:
                  etiquetas: ["uuid-etiqueta-1"]
                  temperatura: "hot"
                  periodo:
                    inicio: "2026-01-01"
                    fim: "2026-01-31"
                  pagina: 1
                  por_pagina: 50
              gerenciar_etiquetas:
                summary: Etiquetas (action=etiquetas)
                value:
                  adicionar: ["uuid-etiqueta-1"]
                  remover: ["uuid-etiqueta-2"]
      responses:
        "200":
          description: Sucesso
        "201":
          description: Contato criado

    put:
      tags: [Contatos]
      summary: Atualizar contato
      operationId: atualizarContato
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarContatoRequest"
      responses:
        "200":
          description: Contato atualizado

    delete:
      tags: [Contatos]
      summary: Remover contato
      operationId: removerContato
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Contato removido

  /api-contatos-lote:
    post:
      tags: [Contatos]
      summary: Criar contatos em lote
      operationId: criarContatosLote
      description: Cria múltiplos contatos (máximo 100 por requisição).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [contatos]
              properties:
                contatos:
                  type: array
                  maxItems: 100
                  items:
                    $ref: "#/components/schemas/CriarContatoLoteItem"
            example:
              contatos:
                - nome: "Maria Silva"
                  telefone: "11999990001"
                  email: "maria@email.com"
                - nome: "João Santos"
                  telefone: "11999990002"
                  tipo_beneficio: "BPC Idoso"
      responses:
        "200":
          description: Resultado do lote
          content:
            application/json:
              schema:
                type: object
                properties:
                  sucesso:
                    type: boolean
                  resumo:
                    type: object
                    properties:
                      total:
                        type: integer
                      criados:
                        type: integer
                      duplicados:
                        type: integer
                      erros:
                        type: integer
                  resultados:
                    type: array
                    items:
                      type: object
                      properties:
                        indice:
                          type: integer
                        sucesso:
                          type: boolean
                        id:
                          type: string
                        erro:
                          type: string
                        duplicado:
                          type: boolean

  # ============================================================================
  # ETIQUETAS
  # ============================================================================
  /api-tags:
    get:
      tags: [Etiquetas]
      summary: Listar etiquetas
      operationId: listarEtiquetas
      parameters:
        - name: id
          in: query
          description: ID da etiqueta (busca específica)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Lista de etiquetas
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Etiqueta"

    post:
      tags: [Etiquetas]
      summary: Criar etiqueta
      operationId: criarEtiqueta
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarEtiquetaRequest"
      responses:
        "201":
          description: Etiqueta criada

    put:
      tags: [Etiquetas]
      summary: Atualizar etiqueta
      operationId: atualizarEtiqueta
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarEtiquetaRequest"
      responses:
        "200":
          description: Etiqueta atualizada

    delete:
      tags: [Etiquetas]
      summary: Remover etiqueta
      operationId: removerEtiqueta
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Etiqueta removida

  # ============================================================================
  # CAMPOS PERSONALIZADOS
  # ============================================================================
  /api-campos-personalizados:
    get:
      tags: [Campos Personalizados]
      summary: Listar campos personalizados
      operationId: listarCamposPersonalizados
      parameters:
        - name: id
          in: query
          schema:
            type: string
            format: uuid
        - name: tenant_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Lista de campos
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/CampoPersonalizado"

    post:
      tags: [Campos Personalizados]
      summary: Criar campo
      operationId: criarCampoPersonalizado
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarCampoRequest"
            example:
              nome: "data_pericia"
              rotulo: "Data da Perícia"
              tipo: "data"
              obrigatorio: false
      responses:
        "201":
          description: Campo criado

    put:
      tags: [Campos Personalizados]
      summary: Atualizar campo
      operationId: atualizarCampoPersonalizado
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarCampoRequest"
      responses:
        "200":
          description: Campo atualizado

    delete:
      tags: [Campos Personalizados]
      summary: Remover campo
      operationId: removerCampoPersonalizado
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Campo removido

  # ============================================================================
  # CARTEIRAS
  # ============================================================================
  /api-carteiras:
    get:
      tags: [Carteiras]
      summary: Listar carteiras
      operationId: listarCarteiras
      parameters:
        - name: id
          in: query
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          description: "contatos: Lista contatos da carteira"
          schema:
            type: string
            enum: [contatos]
        - name: tenant_id
          in: query
          schema:
            type: string
            format: uuid
        - name: pagina
          in: query
          schema:
            type: integer
            default: 1
        - name: por_pagina
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Lista de carteiras
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Carteira"

    post:
      tags: [Carteiras]
      summary: Criar carteira ou adicionar contato
      operationId: criarCarteira
      description: |
        Sem action: Cria carteira
        Com action=contatos: Adiciona contato à carteira (requer id)
      parameters:
        - name: id
          in: query
          description: ID da carteira (para action=contatos)
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          schema:
            type: string
            enum: [contatos]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: "#/components/schemas/CriarCarteiraRequest"
                - type: object
                  required: [contato_id]
                  properties:
                    contato_id:
                      type: string
                      format: uuid
            examples:
              criar_carteira:
                summary: Criar carteira
                value:
                  nome: "Clientes BPC"
                  descricao: "Carteira de clientes BPC"
                  cor: "#22c55e"
              adicionar_contato:
                summary: Adicionar contato (action=contatos)
                value:
                  contato_id: "uuid-do-contato"
      responses:
        "201":
          description: Criado

    put:
      tags: [Carteiras]
      summary: Atualizar carteira
      operationId: atualizarCarteira
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarCarteiraRequest"
      responses:
        "200":
          description: Carteira atualizada

    delete:
      tags: [Carteiras]
      summary: Remover carteira ou contato da carteira
      operationId: removerCarteira
      description: |
        Sem action: Remove a carteira
        Com action=contatos: Remove contato da carteira
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          schema:
            type: string
            enum: [contatos]
        - name: contato_id
          in: query
          description: ID do contato (quando action=contatos)
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Removido

  # ============================================================================
  # WEBHOOKS
  # ============================================================================
  /api-webhooks:
    get:
      tags: [Webhooks]
      summary: Listar webhooks ou eventos
      operationId: listarWebhooks
      parameters:
        - name: id
          in: query
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          description: "eventos: Lista eventos disponíveis"
          schema:
            type: string
            enum: [eventos]
      responses:
        "200":
          description: Lista de webhooks
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Webhook"

    post:
      tags: [Webhooks]
      summary: Criar webhook
      operationId: criarWebhook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarWebhookRequest"
      responses:
        "201":
          description: Webhook criado

    put:
      tags: [Webhooks]
      summary: Atualizar webhook
      operationId: atualizarWebhook
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarWebhookRequest"
      responses:
        "200":
          description: Webhook atualizado

    delete:
      tags: [Webhooks]
      summary: Remover webhook
      operationId: removerWebhook
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Webhook removido

  # ============================================================================
  # ARQUIVOS
  # ============================================================================
  /api-arquivos:
    get:
      tags: [Arquivos]
      summary: Obter URL de upload
      operationId: obterUrlUpload
      parameters:
        - name: nome_arquivo
          in: query
          required: true
          schema:
            type: string
        - name: tipo_mime
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: URL de upload
          content:
            application/json:
              schema:
                type: object
                properties:
                  sucesso:
                    type: boolean
                  upload:
                    type: object
                    properties:
                      url:
                        type: string
                      token:
                        type: string
                      path:
                        type: string
                      expira_em:
                        type: string
                        format: date-time

    post:
      tags: [Arquivos]
      summary: Confirmar upload
      operationId: confirmarUpload
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [path]
              properties:
                path:
                  type: string
                nome_original:
                  type: string
      responses:
        "200":
          description: Upload confirmado

    delete:
      tags: [Arquivos]
      summary: Remover arquivo
      operationId: removerArquivo
      parameters:
        - name: path
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Arquivo removido

  # ============================================================================
  # CONVERSAS
  # ============================================================================
  /api-conversations:
    get:
      tags: [Conversas]
      summary: Listar conversas
      operationId: listarConversas
      parameters:
        - name: id
          in: query
          description: ID da conversa (busca com mensagens)
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          description: "notas: Lista notas da conversa"
          schema:
            type: string
            enum: [notas]
        - name: status
          in: query
          schema:
            type: string
            enum: [open, pending, resolved]
        - name: assigned_to
          in: query
          schema:
            type: string
            format: uuid
        - name: lead_id
          in: query
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Lista de conversas
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Conversa"
                  paginacao:
                    $ref: "#/components/schemas/Paginacao"

    post:
      tags: [Conversas]
      summary: Criar conversa ou adicionar nota
      operationId: criarConversa
      description: |
        Sem action: Cria nova conversa
        Com action=notas: Adiciona nota interna à conversa
      parameters:
        - name: id
          in: query
          description: ID da conversa (para action=notas)
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          schema:
            type: string
            enum: [notas]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  required: [lead_id]
                  properties:
                    lead_id:
                      type: string
                      format: uuid
                    assigned_to:
                      type: string
                      format: uuid
                    status:
                      type: string
                      enum: [open, pending, resolved]
                - type: object
                  required: [conteudo]
                  properties:
                    conteudo:
                      type: string
      responses:
        "201":
          description: Criado

    put:
      tags: [Conversas]
      summary: Atualizar conversa
      operationId: atualizarConversa
      description: |
        Usa action para operações específicas:
        - Sem action: Atualiza dados
        - `transferir`: Transfere para usuário/equipe
        - `atribuir`: Atribui a usuário
        - `finalizar`: Marca como resolvida
        - `reabrir`: Reabre conversa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          schema:
            type: string
            enum: [transferir, atribuir, finalizar, reabrir]
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  properties:
                    status:
                      type: string
                    assigned_to:
                      type: string
                    is_favorite:
                      type: boolean
                - type: object
                  properties:
                    tipo:
                      type: string
                      enum: [usuario, equipe]
                    usuario_id:
                      type: string
                    equipe_id:
                      type: string
      responses:
        "200":
          description: Conversa atualizada

    delete:
      tags: [Conversas]
      summary: Remover conversa
      operationId: removerConversa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Conversa removida

  # ============================================================================
  # MENSAGENS
  # ============================================================================
  /api-mensagens:
    get:
      tags: [Mensagens]
      summary: Buscar mensagens
      operationId: buscarMensagens
      parameters:
        - name: id
          in: query
          description: ID da mensagem
          schema:
            type: string
            format: uuid
        - name: conversa_id
          in: query
          description: ID da conversa
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          description: "status: Retorna status de entrega"
          schema:
            type: string
            enum: [status]
        - name: pagina
          in: query
          schema:
            type: integer
            default: 1
        - name: por_pagina
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Mensagem(ns) encontrada(s)
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Mensagem"
                  paginacao:
                    $ref: "#/components/schemas/Paginacao"

    delete:
      tags: [Mensagens]
      summary: Apagar mensagem
      operationId: apagarMensagem
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Mensagem apagada

  /chat-v2-mensagem:
    post:
      tags: [Mensagens]
      summary: Enviar mensagem
      operationId: enviarMensagem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/EnviarMensagemRequest"
            example:
              contato_id: "uuid-do-contato"
              conteudo: "Olá! Como posso ajudar?"
              tipo: "texto"
      responses:
        "200":
          description: Mensagem enviada
          content:
            application/json:
              schema:
                type: object
                properties:
                  sucesso:
                    type: boolean
                  mensagem_id:
                    type: string
                  status:
                    type: string

  # ============================================================================
  # MENSAGENS AGENDADAS
  # ============================================================================
  /api-mensagens-agendadas:
    get:
      tags: [Mensagens Agendadas]
      summary: Listar mensagens agendadas
      operationId: listarMensagensAgendadas
      parameters:
        - name: id
          in: query
          schema:
            type: string
            format: uuid
        - name: contato_id
          in: query
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, sent, cancelled, failed]
        - name: pagina
          in: query
          schema:
            type: integer
            default: 1
        - name: por_pagina
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Lista de mensagens agendadas
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/MensagemAgendada"
                  paginacao:
                    $ref: "#/components/schemas/Paginacao"

    post:
      tags: [Mensagens Agendadas]
      summary: Agendar mensagem ou cancelar
      operationId: agendarMensagem
      description: |
        Sem action: Agenda nova mensagem
        Com action=cancelar: Cancela mensagem agendada
      parameters:
        - name: id
          in: query
          description: ID da mensagem (para action=cancelar)
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          schema:
            type: string
            enum: [cancelar]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AgendarMensagemRequest"
            example:
              contato_id: "uuid-do-contato"
              conteudo: "Lembrete: sua perícia é amanhã!"
              agendar_para: "2026-01-10T10:00:00Z"
      responses:
        "201":
          description: Mensagem agendada

    put:
      tags: [Mensagens Agendadas]
      summary: Atualizar mensagem agendada
      operationId: atualizarMensagemAgendada
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                conteudo:
                  type: string
                agendar_para:
                  type: string
                  format: date-time
      responses:
        "200":
          description: Mensagem atualizada

  # ============================================================================
  # TEMPLATES
  # ============================================================================
  /api-templates:
    get:
      tags: [Templates]
      summary: Listar templates
      operationId: listarTemplates
      parameters:
        - name: id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Lista de templates
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Template"

    post:
      tags: [Templates]
      summary: Criar template
      operationId: criarTemplate
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarTemplateRequest"
      responses:
        "201":
          description: Template criado

    put:
      tags: [Templates]
      summary: Atualizar template
      operationId: atualizarTemplate
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarTemplateRequest"
      responses:
        "200":
          description: Template atualizado

    delete:
      tags: [Templates]
      summary: Remover template
      operationId: removerTemplate
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Template removido

  # ============================================================================
  # CANAIS
  # ============================================================================
  /api-whatsapp-instances:
    get:
      tags: [Canais]
      summary: Listar canais WhatsApp
      operationId: listarCanais
      parameters:
        - name: id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Lista de canais
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Canal"

  # ============================================================================
  # CHATBOTS
  # ============================================================================
  /api-chatbots:
    get:
      tags: [Chatbots]
      summary: Listar chatbots
      operationId: listarChatbots
      parameters:
        - name: id
          in: query
          schema:
            type: string
            format: uuid
        - name: ativo
          in: query
          schema:
            type: boolean
      responses:
        "200":
          description: Lista de chatbots
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Chatbot"

    post:
      tags: [Chatbots]
      summary: Criar chatbot ou iniciar fluxo
      operationId: criarChatbot
      description: |
        Sem action: Cria chatbot
        Com action=enviar: Inicia fluxo para contato
      parameters:
        - name: action
          in: query
          schema:
            type: string
            enum: [enviar]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: "#/components/schemas/CriarChatbotRequest"
                - type: object
                  required: [chatbot_id, contato_id]
                  properties:
                    chatbot_id:
                      type: string
                      format: uuid
                    contato_id:
                      type: string
                      format: uuid
      responses:
        "201":
          description: Criado

    put:
      tags: [Chatbots]
      summary: Atualizar chatbot
      operationId: atualizarChatbot
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarChatbotRequest"
      responses:
        "200":
          description: Chatbot atualizado

    delete:
      tags: [Chatbots]
      summary: Remover chatbot
      operationId: removerChatbot
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Chatbot removido

  # ============================================================================
  # OPORTUNIDADES
  # ============================================================================
  /api-oportunidades:
    get:
      tags: [Oportunidades]
      summary: Listar oportunidades
      operationId: listarOportunidades
      parameters:
        - name: id
          in: query
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          description: "notas: Lista notas da oportunidade"
          schema:
            type: string
            enum: [notas]
        - name: etapa_id
          in: query
          schema:
            type: string
            format: uuid
        - name: responsavel_id
          in: query
          schema:
            type: string
            format: uuid
        - name: temperatura
          in: query
          schema:
            type: string
            enum: [cold, warm, hot]
        - name: pagina
          in: query
          schema:
            type: integer
            default: 1
        - name: por_pagina
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Lista de oportunidades
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Oportunidade"
                  paginacao:
                    $ref: "#/components/schemas/Paginacao"

    post:
      tags: [Oportunidades]
      summary: Criar oportunidade ou ações
      operationId: criarOportunidade
      description: |
        Sem action: Cria oportunidade
        Com action:
        - `duplicar`: Duplica oportunidade
        - `notas`: Adiciona nota
      parameters:
        - name: id
          in: query
          description: ID da oportunidade (para duplicar/notas)
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          schema:
            type: string
            enum: [duplicar, notas]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - $ref: "#/components/schemas/CriarOportunidadeRequest"
                - type: object
                  required: [conteudo]
                  properties:
                    conteudo:
                      type: string
      responses:
        "201":
          description: Criado

    put:
      tags: [Oportunidades]
      summary: Atualizar oportunidade
      operationId: atualizarOportunidade
      description: |
        Sem action: Atualiza dados
        Com action=mover: Move para outra etapa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          schema:
            type: string
            enum: [mover]
      requestBody:
        content:
          application/json:
            schema:
              oneOf:
                - $ref: "#/components/schemas/AtualizarOportunidadeRequest"
                - type: object
                  required: [etapa_id]
                  properties:
                    etapa_id:
                      type: string
                      format: uuid
                    ordem:
                      type: integer
      responses:
        "200":
          description: Oportunidade atualizada

    delete:
      tags: [Oportunidades]
      summary: Remover oportunidade
      operationId: removerOportunidade
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Oportunidade removida

  # ============================================================================
  # FUNIS
  # ============================================================================
  /api-funnels:
    get:
      tags: [Funis]
      summary: Listar funis
      operationId: listarFunis
      parameters:
        - name: id
          in: query
          description: ID do funil (busca específico)
          schema:
            type: string
        - name: action
          in: query
          description: "campos-personalizados: Retorna campos do funil"
          schema:
            type: string
            enum: [campos-personalizados]
        - name: tenant_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Lista de funis
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Funil"

  # ============================================================================
  # TAREFAS
  # ============================================================================
  /api-tasks:
    get:
      tags: [Tarefas]
      summary: Listar tarefas
      operationId: listarTarefas
      parameters:
        - name: id
          in: query
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum: [todo, in_progress, done]
        - name: assigned_to
          in: query
          schema:
            type: string
            format: uuid
        - name: lead_id
          in: query
          schema:
            type: string
            format: uuid
        - name: page
          in: query
          schema:
            type: integer
            default: 1
        - name: page_size
          in: query
          schema:
            type: integer
            default: 50
      responses:
        "200":
          description: Lista de tarefas
          content:
            application/json:
              schema:
                type: object
                properties:
                  dados:
                    type: array
                    items:
                      $ref: "#/components/schemas/Tarefa"
                  paginacao:
                    $ref: "#/components/schemas/Paginacao"

    post:
      tags: [Tarefas]
      summary: Criar tarefa ou concluir
      operationId: criarTarefa
      description: |
        Sem action: Cria tarefa
        Com action=concluir: Marca como concluída
      parameters:
        - name: id
          in: query
          description: ID da tarefa (para action=concluir)
          schema:
            type: string
            format: uuid
        - name: action
          in: query
          schema:
            type: string
            enum: [concluir]
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CriarTarefaRequest"
      responses:
        "201":
          description: Tarefa criada

    put:
      tags: [Tarefas]
      summary: Atualizar tarefa
      operationId: atualizarTarefa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/AtualizarTarefaRequest"
      responses:
        "200":
          description: Tarefa atualizada

    delete:
      tags: [Tarefas]
      summary: Remover tarefa
      operationId: removerTarefa
      parameters:
        - name: id
          in: query
          required: true
          schema:
            type: string
            format: uuid
      responses:
        "200":
          description: Tarefa removida

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      description: API Key gerada no sistema

  schemas:
    Paginacao:
      type: object
      properties:
        pagina:
          type: integer
        por_pagina:
          type: integer
        total:
          type: integer
        total_paginas:
          type: integer

    # ------------ Usuários ------------
    Usuario:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        email:
          type: string
        telefone:
          type: string
        avatar_url:
          type: string
        cargo:
          type: string
          enum: [administrador, gerente, atendente, visualizador]
        ativo:
          type: boolean
        disponivel:
          type: boolean
        equipes:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              nome:
                type: string
              supervisor:
                type: boolean
        criado_em:
          type: string
          format: date-time

    AtualizarUsuarioRequest:
      type: object
      properties:
        nome:
          type: string
        telefone:
          type: string
        disponivel:
          type: boolean

    # ------------ Equipes ------------
    Equipe:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        nivel_acesso:
          type: string
          enum: [todos, equipe, atendente]
        distribuicao_automatica:
          type: boolean
        equipe_padrao:
          type: boolean
        total_membros:
          type: integer
        criado_em:
          type: string
          format: date-time

    CriarEquipeRequest:
      type: object
      required: [nome]
      properties:
        nome:
          type: string
        nivel_acesso:
          type: string
          enum: [todos, equipe, atendente]
        distribuicao_automatica:
          type: boolean

    AtualizarEquipeRequest:
      type: object
      properties:
        nome:
          type: string
        nivel_acesso:
          type: string
        distribuicao_automatica:
          type: boolean

    # ------------ Contatos ------------
    Contato:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        telefone:
          type: string
        codigo_pais:
          type: string
        email:
          type: string
        cpf:
          type: string
        avatar_url:
          type: string
        etapa_id:
          type: string
        temperatura:
          type: string
          enum: [cold, warm, hot]
        responsavel_id:
          type: string
        tipo_beneficio:
          type: string
        etiquetas:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              nome:
                type: string
              cor:
                type: string
        criado_em:
          type: string
          format: date-time

    CriarContatoRequest:
      type: object
      required: [name, phone]
      properties:
        name:
          type: string
        phone:
          type: string
        country_code:
          type: string
        email:
          type: string
        cpf:
          type: string
        birth_date:
          type: string
          format: date
        benefit_type:
          type: string
        nit_pis:
          type: string
        utm_source:
          type: string
        utm_medium:
          type: string
        source:
          type: string
        stage_id:
          type: string
          format: uuid
        assigned_to:
          type: string
          format: uuid
        temperature:
          type: string
          enum: [cold, warm, hot]
        custom_fields:
          type: object
        tenant_id:
          type: string
          format: uuid

    CriarContatosLoteRequest:
      type: object
      required: [contatos]
      properties:
        contatos:
          type: array
          maxItems: 100
          items:
            type: object
            required: [name, phone]
            properties:
              name:
                type: string
              phone:
                type: string
              email:
                type: string
              source:
                type: string
              temperature:
                type: string
                enum: [cold, warm, hot]

    FiltroAvancadoRequest:
      type: object
      properties:
        etiquetas:
          type: array
          items:
            type: string
            format: uuid
        campos:
          type: object
          description: Filtrar por campos personalizados
        periodo:
          type: object
          properties:
            inicio:
              type: string
              format: date
            fim:
              type: string
              format: date
        temperatura:
          type: string
          enum: [cold, warm, hot]
        etapa_funil:
          type: string
        responsavel:
          type: string
        tenant_id:
          type: string
          format: uuid
        pagina:
          type: integer
          default: 1
        por_pagina:
          type: integer
          default: 50

    GerenciarEtiquetasRequest:
      type: object
      properties:
        adicionar:
          type: array
          items:
            type: string
            format: uuid
        remover:
          type: array
          items:
            type: string
            format: uuid

    CriarContatoLoteItem:
      type: object
      required: [nome, telefone]
      properties:
        nome:
          type: string
        telefone:
          type: string
        codigo_pais:
          type: string
        email:
          type: string
        cpf:
          type: string
        tipo_beneficio:
          type: string
        origem:
          type: string
        etiquetas:
          type: array
          items:
            type: string
            format: uuid

    AtualizarContatoRequest:
      type: object
      properties:
        name:
          type: string
        phone:
          type: string
        email:
          type: string
        stage_id:
          type: string
          format: uuid
        temperature:
          type: string
          enum: [cold, warm, hot]
        assigned_to:
          type: string
          format: uuid

    # ------------ Etiquetas ------------
    Etiqueta:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        cor:
          type: string
        categoria:
          type: string
          enum: [origem, interesse, prioridade, status, beneficio, condicao_saude, desqualificacao]

    CriarEtiquetaRequest:
      type: object
      required: [nome]
      properties:
        nome:
          type: string
        cor:
          type: string
        categoria:
          type: string

    AtualizarEtiquetaRequest:
      type: object
      properties:
        nome:
          type: string
        cor:
          type: string

    # ------------ Campos Personalizados ------------
    CampoPersonalizado:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        rotulo:
          type: string
        tipo:
          type: string
          enum: [texto, numero, data, selecao, selecao_multipla, booleano]
        opcoes:
          type: array
          items:
            type: string
        obrigatorio:
          type: boolean
        ordem:
          type: integer
        ativo:
          type: boolean

    CriarCampoRequest:
      type: object
      required: [nome, rotulo]
      properties:
        nome:
          type: string
        rotulo:
          type: string
        tipo:
          type: string
          enum: [texto, numero, data, selecao, selecao_multipla, booleano]
        opcoes:
          type: array
          items:
            type: string
        obrigatorio:
          type: boolean
        ordem:
          type: integer

    AtualizarCampoRequest:
      type: object
      properties:
        nome:
          type: string
        rotulo:
          type: string
        tipo:
          type: string
        opcoes:
          type: array
          items:
            type: string
        obrigatorio:
          type: boolean
        ordem:
          type: integer

    # ------------ Carteiras ------------
    Carteira:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        descricao:
          type: string
        cor:
          type: string
        total_contatos:
          type: integer
        criada_em:
          type: string
          format: date-time

    CriarCarteiraRequest:
      type: object
      required: [nome]
      properties:
        nome:
          type: string
        descricao:
          type: string
        cor:
          type: string

    AtualizarCarteiraRequest:
      type: object
      properties:
        nome:
          type: string
        descricao:
          type: string
        cor:
          type: string

    # ------------ Webhooks ------------
    Webhook:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        url:
          type: string
        eventos:
          type: array
          items:
            type: string
        ativo:
          type: boolean
        criado_em:
          type: string
          format: date-time

    CriarWebhookRequest:
      type: object
      required: [nome, url, eventos]
      properties:
        nome:
          type: string
        url:
          type: string
        eventos:
          type: array
          items:
            type: string
        headers:
          type: object

    AtualizarWebhookRequest:
      type: object
      properties:
        nome:
          type: string
        url:
          type: string
        eventos:
          type: array
          items:
            type: string
        ativo:
          type: boolean

    # ------------ Conversas ------------
    Conversa:
      type: object
      properties:
        id:
          type: string
        lead_id:
          type: string
        lead:
          type: object
          properties:
            id:
              type: string
            name:
              type: string
            phone:
              type: string
            avatar_url:
              type: string
        assigned_to:
          type: string
        status:
          type: string
          enum: [open, pending, resolved]
        unread_count:
          type: integer
        last_message_at:
          type: string
          format: date-time
        last_message_content:
          type: string
        is_favorite:
          type: boolean
        created_at:
          type: string
          format: date-time

    # ------------ Mensagens ------------
    Mensagem:
      type: object
      properties:
        id:
          type: string
        conversation_id:
          type: string
        type:
          type: string
          enum: [text, image, audio, video, document]
        content:
          type: string
        sender_type:
          type: string
          enum: [lead, agent]
        sender_id:
          type: string
        direction:
          type: string
          enum: [inbound, outbound]
        status:
          type: string
          enum: [sent, delivered, read]
        media_url:
          type: string
        created_at:
          type: string
          format: date-time

    EnviarMensagemRequest:
      type: object
      required: [conteudo]
      description: |
        Enviar mensagem. Use `contato_id` OU `telefone` para identificar o destinatário.
      properties:
        contato_id:
          type: string
          format: uuid
          description: ID do contato (alternativo ao telefone)
        telefone:
          type: string
          description: Número de telefone (alternativo ao contato_id)
        tipo:
          type: string
          enum: [texto, imagem, audio, video, documento]
          default: texto
        conteudo:
          type: string
        midia_url:
          type: string
        instancia_id:
          type: string
          format: uuid
          description: ID da instância WhatsApp a usar

    # ------------ Mensagens Agendadas ------------
    MensagemAgendada:
      type: object
      properties:
        id:
          type: string
        contato_id:
          type: string
        conversa_id:
          type: string
        conteudo:
          type: string
        agendado_para:
          type: string
          format: date-time
        status:
          type: string
          enum: [pending, sent, cancelled, failed]
        enviado_em:
          type: string
          format: date-time
        criado_em:
          type: string
          format: date-time

    AgendarMensagemRequest:
      type: object
      required: [contato_id, conteudo, agendar_para]
      properties:
        contato_id:
          type: string
          format: uuid
        conversa_id:
          type: string
          format: uuid
        conteudo:
          type: string
        agendar_para:
          type: string
          format: date-time
        template_id:
          type: string
          format: uuid

    # ------------ Templates ------------
    Template:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        atalho:
          type: string
        conteudo:
          type: string
        criado_em:
          type: string
          format: date-time

    CriarTemplateRequest:
      type: object
      required: [nome, atalho, conteudo]
      properties:
        nome:
          type: string
        atalho:
          type: string
        conteudo:
          type: string

    AtualizarTemplateRequest:
      type: object
      properties:
        nome:
          type: string
        atalho:
          type: string
        conteudo:
          type: string

    # ------------ Canais ------------
    Canal:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        tipo:
          type: string
          enum: [whatsapp]
        telefone:
          type: string
        ativo:
          type: boolean
        criado_em:
          type: string
          format: date-time

    # ------------ Chatbots ------------
    Chatbot:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        descricao:
          type: string
        ativo:
          type: boolean
        nodes:
          type: array
          items:
            type: object
        connections:
          type: array
          items:
            type: object
        criado_em:
          type: string
          format: date-time

    CriarChatbotRequest:
      type: object
      required: [nome]
      properties:
        nome:
          type: string
        descricao:
          type: string
        nodes:
          type: array
          items:
            type: object
        connections:
          type: array
          items:
            type: object
        ativo:
          type: boolean

    AtualizarChatbotRequest:
      type: object
      properties:
        nome:
          type: string
        descricao:
          type: string
        nodes:
          type: array
          items:
            type: object
        connections:
          type: array
          items:
            type: object
        ativo:
          type: boolean

    # ------------ Oportunidades ------------
    Oportunidade:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        telefone:
          type: string
        email:
          type: string
        etapa_id:
          type: string
        etapa:
          type: object
          properties:
            id:
              type: string
            nome:
              type: string
            cor:
              type: string
        temperatura:
          type: string
          enum: [cold, warm, hot]
        responsavel_id:
          type: string
        valor_estimado:
          type: number
        tipo_beneficio:
          type: string
        etiquetas:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              nome:
                type: string
              cor:
                type: string
        criado_em:
          type: string
          format: date-time

    CriarOportunidadeRequest:
      type: object
      required: [nome, telefone]
      properties:
        nome:
          type: string
        telefone:
          type: string
        email:
          type: string
        etapa_id:
          type: string
          format: uuid
        responsavel_id:
          type: string
          format: uuid
        temperatura:
          type: string
          enum: [cold, warm, hot]
        valor_estimado:
          type: number
        tipo_beneficio:
          type: string
        origem:
          type: string

    AtualizarOportunidadeRequest:
      type: object
      properties:
        nome:
          type: string
        telefone:
          type: string
        email:
          type: string
        etapa_id:
          type: string
          format: uuid
        responsavel_id:
          type: string
          format: uuid
        temperatura:
          type: string
          enum: [cold, warm, hot]
        valor_estimado:
          type: number
        tipo_beneficio:
          type: string

    # ------------ Funis ------------
    Funil:
      type: object
      properties:
        id:
          type: string
        nome:
          type: string
        total_etapas:
          type: integer
        total_oportunidades:
          type: integer
        etapas:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              nome:
                type: string
              ordem:
                type: integer
              cor:
                type: string
              total:
                type: integer

    # ------------ Tarefas ------------
    Tarefa:
      type: object
      properties:
        id:
          type: string
        titulo:
          type: string
        descricao:
          type: string
        status:
          type: string
          enum: [todo, in_progress, done]
        prioridade:
          type: string
          enum: [urgent, high, medium, low]
        responsavel_id:
          type: string
        contato_id:
          type: string
        data_vencimento:
          type: string
          format: date-time
        subtarefas:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
              titulo:
                type: string
              concluida:
                type: boolean
        criada_em:
          type: string
          format: date-time

    CriarTarefaRequest:
      type: object
      required: [titulo, responsavel_id]
      properties:
        titulo:
          type: string
        descricao:
          type: string
        prioridade:
          type: string
          enum: [urgent, high, medium, low]
        responsavel_id:
          type: string
          format: uuid
        contato_id:
          type: string
          format: uuid
        data_vencimento:
          type: string
          format: date-time

    AtualizarTarefaRequest:
      type: object
      properties:
        titulo:
          type: string
        descricao:
          type: string
        status:
          type: string
          enum: [todo, in_progress, done]
        prioridade:
          type: string
        data_vencimento:
          type: string
          format: date-time

  responses:
    NaoAutorizado:
      description: Token inválido ou ausente
      content:
        application/json:
          schema:
            type: object
            properties:
              sucesso:
                type: boolean
                example: false
              erro:
                type: string
                example: "API key inválida"

    RequisicaoInvalida:
      description: Dados inválidos
      content:
        application/json:
          schema:
            type: object
            properties:
              sucesso:
                type: boolean
                example: false
              erro:
                type: string

    NaoEncontrado:
      description: Recurso não encontrado
      content:
        application/json:
          schema:
            type: object
            properties:
              sucesso:
                type: boolean
                example: false
              erro:
                type: string
                example: "Recurso não encontrado"
